;-----------------------------------------------------------------------		
;
; G: RAM-CART Driver for CAS (use XEX2CAS)
; (c) GienekP
;
;-----------------------------------------------------------------------		
LOAD  = $0700
;-----------------------------------------------------------------------
.LOCAL
;-----------------------------------------------------------------------
CASINI  = $02
WARMST  = $08
BOOT?   = $09
DOSINI  = $0C
COLDST  = $0244
BASICF	= $03F8
PORTB   = $D301
CDST    = $A000
RESETVEC= $FFFC 
;-----------------------------------------------------------------------
CASADD  = LOAD-(CASPRC-CASSTA)
;-----------------------------------------------------------------------	
		OPT h-f+
		ORG CASADD
CASSTA	dta $00
		dta [(CASSTP-CASSTA)/128+1]
		dta <CASADD
		dta >CASADD
		dta <CASPRC
		dta >CASPRC
;-----------------------------------------------------------------------
		lda BASICF
		cmp #$00
		beq ISBASIC

		lda #$01
		sta BOOT?
		
		lda #$00
		sta COLDST
		
		lda #$FF
		sta WARMST
		
		lda <CASPRC
		sta CASINI
		sta DOSINI
		lda >CASPRC
		sta CASINI+1
		sta DOSINI+1
		
		lda #$00
		sta BASICF
		lda PORTB
		and #$FD
		sta PORTB

		;jsr CDST

		jmp (RESETVEC)
				
ISBASIC	clc
		rts
;-----------------------------------------------------------------------		
.ENDL
;-----------------------------------------------------------------------		
CASPRC		
;-----------------------------------------------------------------------		
		ICL "grcdrv.asm"
;-----------------------------------------------------------------------		
CASSTP
;-----------------------------------------------------------------------		
